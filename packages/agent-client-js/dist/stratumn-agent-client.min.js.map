{"version":3,"file":null,"sources":["../src/deprecated.js","../src/makeQueryString.js","../src/promiseWhile.js","../src/request.js","../src/findSegments.js","../src/getBranches.js","../src/segmentify.js","../src/createMap.js","../src/getSegment.js","../src/getMapIds.js","../src/getLink.js","../src/getMap.js","../src/processify.js","../src/getProcesses.js","../src/getAgent.js","../src/fromSegment.js","../src/getApplication.js","../src/loadLink.js","../node_modules/setimmediate/setImmediate.js","../node_modules/httpplease/plugins/jsonrequest.js","../node_modules/httpplease/plugins/jsonresponse.js","../node_modules/httpplease/plugins/json.js","../node_modules/httpplease/plugins/cleanurl.js","../node_modules/httpplease/lib/xhr-browser.js","../node_modules/httpplease/lib/utils/delay.js","../node_modules/httpplease/lib/request.js","../node_modules/xtend/index.js","../node_modules/httpplease/lib/utils/extractResponseProps.js","../node_modules/httpplease/lib/response.js","../node_modules/httpplease/lib/error.js","../node_modules/httpplease/lib/utils/once.js","../node_modules/httpplease/lib/index.js","../src/config.js"],"sourcesContent":["/*\n  Copyright 2017 Stratumn SAS. All rights reserved.\n\n  Licensed under the Apache License, Version 2.0 (the \"License\");\n  you may not use this file except in compliance with the License.\n  You may obtain a copy of the License at\n\n      http://www.apache.org/licenses/LICENSE-2.0\n\n  Unless required by applicable law or agreed to in writing, software\n  distributed under the License is distributed on an \"AS IS\" BASIS,\n  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n  See the License for the specific language governing permissions and\n  limitations under the License.\n*/\n\nexport default function deprecated(oldFunc, newFunc) {\n  if (!newFunc) {\n    console.warn(`WARNING: ${oldFunc} is deprecated.`);\n  } else {\n    console.warn(`WARNING: ${oldFunc} is deprecated. Please use ${newFunc} instead.`);\n  }\n}\n","/*\n  Copyright 2017 Stratumn SAS. All rights reserved.\n\n  Licensed under the Apache License, Version 2.0 (the \"License\");\n  you may not use this file except in compliance with the License.\n  You may obtain a copy of the License at\n\n      http://www.apache.org/licenses/LICENSE-2.0\n\n  Unless required by applicable law or agreed to in writing, software\n  distributed under the License is distributed on an \"AS IS\" BASIS,\n  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n  See the License for the specific language governing permissions and\n  limitations under the License.\n*/\n\n/**\n * Makes a query string.\n * @param {object} obj - an object of keys\n * @returns {string} a query string\n */\nexport default function makeQueryString(obj) {\n  const parts = Object.keys(obj).reduce((curr, key) => {\n    const val = Array.isArray(obj[key]) ? obj[key].join('+') : obj[key];\n    curr.push(`${encodeURIComponent(key)}=${encodeURIComponent(val)}`);\n    return curr;\n  }, []);\n\n  if (parts.length) {\n    return `?${parts.join('&')}`;\n  }\n\n  return '';\n}\n","/*\n  Copyright 2017 Stratumn SAS. All rights reserved.\n\n  Licensed under the Apache License, Version 2.0 (the \"License\");\n  you may not use this file except in compliance with the License.\n  You may obtain a copy of the License at\n\n      http://www.apache.org/licenses/LICENSE-2.0\n\n  Unless required by applicable law or agreed to in writing, software\n  distributed under the License is distributed on an \"AS IS\" BASIS,\n  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n  See the License for the specific language governing permissions and\n  limitations under the License.\n*/\n\nimport 'setimmediate';\n\n/**\n * Calls a function that returns a Promise until a condition is reached\n * @param {function} condition - while condition is true body will keep being called\n * @param {function} body - a function that is repeatedly called while condition is true\n * @returns {Promise} a Promise that resolves when the condition is no longer true\n */\nexport default function promiseWhile(condition, body) {\n  return new Promise((resolve, reject) => {\n    function loop() {\n      body()\n      .then(() => {\n        // When the result of calling `condition` is no longer true, we are\n        // done.\n        if (!condition()) {\n          resolve();\n        } else {\n          loop();\n        }\n      })\n      .catch(reject);\n    }\n\n    // Start running the loop in the next tick so that this function is\n    // completely async. It would be unexpected if `body` was called\n    // synchronously the first time.\n    setImmediate(loop);\n  });\n}\n","/*\n  Copyright 2017 Stratumn SAS. All rights reserved.\n\n  Licensed under the Apache License, Version 2.0 (the \"License\");\n  you may not use this file except in compliance with the License.\n  You may obtain a copy of the License at\n\n      http://www.apache.org/licenses/LICENSE-2.0\n\n  Unless required by applicable law or agreed to in writing, software\n  distributed under the License is distributed on an \"AS IS\" BASIS,\n  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n  See the License for the specific language governing permissions and\n  limitations under the License.\n*/\n\nimport json from 'httpplease/plugins/json';\nimport httpplease from 'httpplease';\n\nconst request = httpplease.use(json);\n\nfunction send(method, url, args) {\n  return new Promise((resolve, reject) => {\n    request({ method, url, body: args }, (err, res) => {\n      if (err) {\n        const error = (err && err.body && err.body.meta && err.body.meta.errorMessage)\n          ? new Error(err.body.meta.errorMessage)\n          : err;\n        error.status = err.status;\n        reject(error);\n      } else {\n        resolve(res);\n      }\n    });\n  });\n}\n\nexport function get(url) {\n  return send('GET', url);\n}\n\nexport function post(url, args) {\n  return send('POST', url, args);\n}\n","/*\n  Copyright 2017 Stratumn SAS. All rights reserved.\n\n  Licensed under the Apache License, Version 2.0 (the \"License\");\n  you may not use this file except in compliance with the License.\n  You may obtain a copy of the License at\n\n      http://www.apache.org/licenses/LICENSE-2.0\n\n  Unless required by applicable law or agreed to in writing, software\n  distributed under the License is distributed on an \"AS IS\" BASIS,\n  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n  See the License for the specific language governing permissions and\n  limitations under the License.\n*/\n\nimport segmentify from './segmentify';\nimport makeQueryString from './makeQueryString';\nimport promiseWhile from './promiseWhile';\nimport { get } from './request';\n\nconst DEFAULT_BATCH_SIZE = 20;\n\nexport default function findSegments(process, opts = {}) {\n  const options = Object.assign({}, opts);\n  if (opts.limit === -1) {\n    options.limit = options.batchSize || DEFAULT_BATCH_SIZE;\n    delete options.batchSize;\n    options.offset = 0;\n    let lastBatch = [];\n    const result = [];\n\n    return promiseWhile(\n      () => lastBatch.length === options.limit,\n      () => findSegments(process, options)\n        .then(newSegments => {\n          lastBatch = newSegments;\n          result.push(...newSegments);\n          options.offset += options.limit;\n        })\n    ).then(() => result);\n  }\n  return get(`${process.prefixUrl}/segments${makeQueryString(opts)}`)\n    .then(res => res.body.map(obj => segmentify(process, obj)));\n}\n","/*\n  Copyright 2017 Stratumn SAS. All rights reserved.\n\n  Licensed under the Apache License, Version 2.0 (the \"License\");\n  you may not use this file except in compliance with the License.\n  You may obtain a copy of the License at\n\n      http://www.apache.org/licenses/LICENSE-2.0\n\n  Unless required by applicable law or agreed to in writing, software\n  distributed under the License is distributed on an \"AS IS\" BASIS,\n  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n  See the License for the specific language governing permissions and\n  limitations under the License.\n*/\n\nimport findSegments from './findSegments';\nimport deprecated from './deprecated';\n\nexport default function getBranches(agent, prevLinkHash, tags = []) {\n  deprecated(\n    'Agent#getBranches(agent, prevLinkHash, tags = [])',\n    'Agent#findSegments(agent, filter)'\n  );\n\n  return findSegments(agent, { prevLinkHash, tags });\n}\n","/*\n  Copyright 2017 Stratumn SAS. All rights reserved.\n\n  Licensed under the Apache License, Version 2.0 (the \"License\");\n  you may not use this file except in compliance with the License.\n  You may obtain a copy of the License at\n\n      http://www.apache.org/licenses/LICENSE-2.0\n\n  Unless required by applicable law or agreed to in writing, software\n  distributed under the License is distributed on an \"AS IS\" BASIS,\n  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n  See the License for the specific language governing permissions and\n  limitations under the License.\n*/\n\nimport deprecated from './deprecated';\nimport getBranches from './getBranches';\nimport { post } from './request';\n\nexport default function segmentify(process, obj) {\n  Object.keys(process.processInfo.actions)\n    .filter(key => ['init'].indexOf(key) < 0)\n    .forEach(key => {\n      /*eslint-disable*/\n      obj[key] = (...args) => {\n        return post(`${process.prefixUrl}/segments/${obj.meta.linkHash}/${key}`, args)\n          .then(res => segmentify(process, res.body));\n      }\n    });\n\n  /*eslint-disable*/\n  obj.getPrev = () => {\n    /*eslint-enable*/\n    if (obj.link.meta.prevLinkHash) {\n      return process.getSegment(obj.link.meta.prevLinkHash);\n    }\n\n    return Promise.resolve(null);\n  };\n\n  // Deprecated.\n  /*eslint-disable*/\n  obj.load = () => {\n    /*eslint-enable*/\n    deprecated('segment#load()');\n    return Promise.resolve(segmentify(process, {\n      link: JSON.parse(JSON.stringify(obj.link)),\n      meta: JSON.parse(JSON.stringify(obj.meta))\n    }));\n  };\n\n  // Deprecated.\n  /*eslint-disable*/\n  obj.getBranches = (...args) => {\n    /*eslint-enable*/\n    return getBranches(process, obj.meta.linkHash, ...args);\n  };\n\n  return obj;\n}\n","/*\n  Copyright 2017 Stratumn SAS. All rights reserved.\n\n  Licensed under the Apache License, Version 2.0 (the \"License\");\n  you may not use this file except in compliance with the License.\n  You may obtain a copy of the License at\n\n      http://www.apache.org/licenses/LICENSE-2.0\n\n  Unless required by applicable law or agreed to in writing, software\n  distributed under the License is distributed on an \"AS IS\" BASIS,\n  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n  See the License for the specific language governing permissions and\n  limitations under the License.\n*/\n\nimport segmentify from './segmentify';\nimport { post } from './request';\n\nexport default function createMap(process, ...args) {\n  return post(`${process.prefixUrl}/segments`, args)\n    .then(res => segmentify(process, res.body));\n}\n","/*\n  Copyright 2017 Stratumn SAS. All rights reserved.\n\n  Licensed under the Apache License, Version 2.0 (the \"License\");\n  you may not use this file except in compliance with the License.\n  You may obtain a copy of the License at\n\n      http://www.apache.org/licenses/LICENSE-2.0\n\n  Unless required by applicable law or agreed to in writing, software\n  distributed under the License is distributed on an \"AS IS\" BASIS,\n  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n  See the License for the specific language governing permissions and\n  limitations under the License.\n*/\n\nimport segmentify from './segmentify';\nimport { get } from './request';\n\nexport default function getSegment(process, linkHash) {\n  return get(`${process.prefixUrl}/segments/${linkHash}`)\n    .then(res => segmentify(process, res.body));\n}\n","/*\n  Copyright 2017 Stratumn SAS. All rights reserved.\n\n  Licensed under the Apache License, Version 2.0 (the \"License\");\n  you may not use this file except in compliance with the License.\n  You may obtain a copy of the License at\n\n      http://www.apache.org/licenses/LICENSE-2.0\n\n  Unless required by applicable law or agreed to in writing, software\n  distributed under the License is distributed on an \"AS IS\" BASIS,\n  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n  See the License for the specific language governing permissions and\n  limitations under the License.\n*/\n\nimport makeQueryString from './makeQueryString';\nimport { get } from './request';\n\nexport default function getMapIds(process, opts = {}) {\n  return get(`${process.prefixUrl}/maps${makeQueryString(opts)}`)\n    .then(res => res.body);\n}\n","/*\n  Copyright 2017 Stratumn SAS. All rights reserved.\n\n  Licensed under the Apache License, Version 2.0 (the \"License\");\n  you may not use this file except in compliance with the License.\n  You may obtain a copy of the License at\n\n      http://www.apache.org/licenses/LICENSE-2.0\n\n  Unless required by applicable law or agreed to in writing, software\n  distributed under the License is distributed on an \"AS IS\" BASIS,\n  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n  See the License for the specific language governing permissions and\n  limitations under the License.\n*/\n\nimport getSegment from './getSegment';\nimport deprecated from './deprecated';\n\nexport default function getLink(process, hash) {\n  deprecated('Agent#getLink(agent, hash)', 'Agent#getSegment(agent, hash)');\n\n  return getSegment(process, hash);\n}\n","/*\n  Copyright 2017 Stratumn SAS. All rights reserved.\n\n  Licensed under the Apache License, Version 2.0 (the \"License\");\n  you may not use this file except in compliance with the License.\n  You may obtain a copy of the License at\n\n      http://www.apache.org/licenses/LICENSE-2.0\n\n  Unless required by applicable law or agreed to in writing, software\n  distributed under the License is distributed on an \"AS IS\" BASIS,\n  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n  See the License for the specific language governing permissions and\n  limitations under the License.\n*/\n\nimport findSegments from './findSegments';\nimport deprecated from './deprecated';\n\nexport default function getMap(process, mapId, tags = []) {\n  deprecated('getMap(agent, mapId, tags = [])', 'findSegments(agent, filter)');\n\n  return findSegments(process, { mapIds: mapId, tags });\n}\n","/*\n  Copyright 2017 Stratumn SAS. All rights reserved.\n\n  Licensed under the Apache License, Version 2.0 (the \"License\");\n  you may not use this file except in compliance with the License.\n  You may obtain a copy of the License at\n\n      http://www.apache.org/licenses/LICENSE-2.0\n\n  Unless required by applicable law or agreed to in writing, software\n  distributed under the License is distributed on an \"AS IS\" BASIS,\n  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n  See the License for the specific language governing permissions and\n  limitations under the License.\n*/\n\nimport createMap from './createMap';\nimport getSegment from './getSegment';\nimport findSegments from './findSegments';\nimport getMapIds from './getMapIds';\n\n// Deprecated.\nimport getBranches from './getBranches';\nimport getLink from './getLink';\nimport getMap from './getMap';\n\nexport default function processify(process, agentUrl) {\n  const updatedProcess = process;\n  updatedProcess.agentUrl = agentUrl;\n  updatedProcess.prefixUrl = `${agentUrl}/${process.name}`;\n  updatedProcess.createMap = createMap.bind(null, updatedProcess);\n  updatedProcess.getSegment = getSegment.bind(null, updatedProcess);\n  updatedProcess.findSegments = findSegments.bind(null, updatedProcess);\n  updatedProcess.getMapIds = getMapIds.bind(null, updatedProcess);\n\n  // Deprecated.\n  updatedProcess.getBranches = getBranches.bind(null, updatedProcess);\n  updatedProcess.getLink = getLink.bind(null, updatedProcess);\n  updatedProcess.getMap = getMap.bind(null, updatedProcess);\n\n  return updatedProcess;\n}\n","/*\n  Copyright 2017 Stratumn SAS. All rights reserved.\n\n  Licensed under the Apache License, Version 2.0 (the \"License\");\n  you may not use this file except in compliance with the License.\n  You may obtain a copy of the License at\n\n      http://www.apache.org/licenses/LICENSE-2.0\n\n  Unless required by applicable law or agreed to in writing, software\n  distributed under the License is distributed on an \"AS IS\" BASIS,\n  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n  See the License for the specific language governing permissions and\n  limitations under the License.\n*/\n\nimport processify from './processify';\nimport { get } from './request';\n\nexport default function getProcesses(agent) {\n  return get(`${agent.url}/processes`)\n    .then(res => res.body.map(processify));\n}\n","/*\n  Copyright 2017 Stratumn SAS. All rights reserved.\n\n  Licensed under the Apache License, Version 2.0 (the \"License\");\n  you may not use this file except in compliance with the License.\n  You may obtain a copy of the License at\n\n      http://www.apache.org/licenses/LICENSE-2.0\n\n  Unless required by applicable law or agreed to in writing, software\n  distributed under the License is distributed on an \"AS IS\" BASIS,\n  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n  See the License for the specific language governing permissions and\n  limitations under the License.\n*/\n\nimport getProcesses from './getProcesses';\nimport processify from './processify';\nimport { get } from './request';\n\nexport default function getAgent(url) {\n  return get(url)\n    .then(res => {\n      const agent = res.body;\n      agent.url = url;\n      agent.getProcesses = getProcesses.bind(null, agent);\n      agent.processes = Object.keys(agent.processes)\n        .map(key => agent.processes[key])\n        .reduce((map, p) => {\n          const updatedMap = map;\n          updatedMap[p.name] = processify(p, agent.url);\n          return updatedMap;\n        }, {});\n      return agent;\n    });\n}\n","/*\n  Copyright 2017 Stratumn SAS. All rights reserved.\n\n  Licensed under the Apache License, Version 2.0 (the \"License\");\n  you may not use this file except in compliance with the License.\n  You may obtain a copy of the License at\n\n      http://www.apache.org/licenses/LICENSE-2.0\n\n  Unless required by applicable law or agreed to in writing, software\n  distributed under the License is distributed on an \"AS IS\" BASIS,\n  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n  See the License for the specific language governing permissions and\n  limitations under the License.\n*/\n\nimport getAgent from './getAgent';\nimport segmentify from './segmentify';\n\nexport default function fromSegment(obj) {\n  return getAgent(obj.meta.agentUrl || obj.meta.applicationLocation)\n    .then(agent => {\n      if (!agent.processes[obj.link.meta.process]) {\n        throw new Error(`process '${obj.link.meta.process}' not found`);\n      }\n      const segment = segmentify(agent.processes[obj.link.meta.process], obj);\n      return { process: agent.processes[obj.link.meta.process], segment };\n    });\n}\n","/*\n  Copyright 2017 Stratumn SAS. All rights reserved.\n\n  Licensed under the Apache License, Version 2.0 (the \"License\");\n  you may not use this file except in compliance with the License.\n  You may obtain a copy of the License at\n\n      http://www.apache.org/licenses/LICENSE-2.0\n\n  Unless required by applicable law or agreed to in writing, software\n  distributed under the License is distributed on an \"AS IS\" BASIS,\n  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n  See the License for the specific language governing permissions and\n  limitations under the License.\n*/\n\nimport getAgent from './getAgent';\nimport deprecated from './deprecated';\nimport config from './config';\n\nexport default function getApplication(name, url) {\n  deprecated('getApplication(name, url)', 'getAgent(url)');\n\n  return getAgent(url || config.applicationUrl.replace('%s', name));\n}\n","/*\n  Copyright 2017 Stratumn SAS. All rights reserved.\n\n  Licensed under the Apache License, Version 2.0 (the \"License\");\n  you may not use this file except in compliance with the License.\n  You may obtain a copy of the License at\n\n      http://www.apache.org/licenses/LICENSE-2.0\n\n  Unless required by applicable law or agreed to in writing, software\n  distributed under the License is distributed on an \"AS IS\" BASIS,\n  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n  See the License for the specific language governing permissions and\n  limitations under the License.\n*/\n\nimport fromSegment from './fromSegment';\nimport deprecated from './deprecated';\n\nexport default function loadLink(obj) {\n  deprecated('loadLink(obj)', 'fromSegment(obj)');\n\n  return fromSegment(obj)\n    .then(({ segment }) => segment);\n}\n","(function (global, undefined) {\n    \"use strict\";\n\n    if (global.setImmediate) {\n        return;\n    }\n\n    var nextHandle = 1; // Spec says greater than zero\n    var tasksByHandle = {};\n    var currentlyRunningATask = false;\n    var doc = global.document;\n    var registerImmediate;\n\n    function setImmediate(callback) {\n      // Callback can either be a function or a string\n      if (typeof callback !== \"function\") {\n        callback = new Function(\"\" + callback);\n      }\n      // Copy function arguments\n      var args = new Array(arguments.length - 1);\n      for (var i = 0; i < args.length; i++) {\n          args[i] = arguments[i + 1];\n      }\n      // Store and register the task\n      var task = { callback: callback, args: args };\n      tasksByHandle[nextHandle] = task;\n      registerImmediate(nextHandle);\n      return nextHandle++;\n    }\n\n    function clearImmediate(handle) {\n        delete tasksByHandle[handle];\n    }\n\n    function run(task) {\n        var callback = task.callback;\n        var args = task.args;\n        switch (args.length) {\n        case 0:\n            callback();\n            break;\n        case 1:\n            callback(args[0]);\n            break;\n        case 2:\n            callback(args[0], args[1]);\n            break;\n        case 3:\n            callback(args[0], args[1], args[2]);\n            break;\n        default:\n            callback.apply(undefined, args);\n            break;\n        }\n    }\n\n    function runIfPresent(handle) {\n        // From the spec: \"Wait until any invocations of this algorithm started before this one have completed.\"\n        // So if we're currently running a task, we'll need to delay this invocation.\n        if (currentlyRunningATask) {\n            // Delay by doing a setTimeout. setImmediate was tried instead, but in Firefox 7 it generated a\n            // \"too much recursion\" error.\n            setTimeout(runIfPresent, 0, handle);\n        } else {\n            var task = tasksByHandle[handle];\n            if (task) {\n                currentlyRunningATask = true;\n                try {\n                    run(task);\n                } finally {\n                    clearImmediate(handle);\n                    currentlyRunningATask = false;\n                }\n            }\n        }\n    }\n\n    function installNextTickImplementation() {\n        registerImmediate = function(handle) {\n            process.nextTick(function () { runIfPresent(handle); });\n        };\n    }\n\n    function canUsePostMessage() {\n        // The test against `importScripts` prevents this implementation from being installed inside a web worker,\n        // where `global.postMessage` means something completely different and can't be used for this purpose.\n        if (global.postMessage && !global.importScripts) {\n            var postMessageIsAsynchronous = true;\n            var oldOnMessage = global.onmessage;\n            global.onmessage = function() {\n                postMessageIsAsynchronous = false;\n            };\n            global.postMessage(\"\", \"*\");\n            global.onmessage = oldOnMessage;\n            return postMessageIsAsynchronous;\n        }\n    }\n\n    function installPostMessageImplementation() {\n        // Installs an event handler on `global` for the `message` event: see\n        // * https://developer.mozilla.org/en/DOM/window.postMessage\n        // * http://www.whatwg.org/specs/web-apps/current-work/multipage/comms.html#crossDocumentMessages\n\n        var messagePrefix = \"setImmediate$\" + Math.random() + \"$\";\n        var onGlobalMessage = function(event) {\n            if (event.source === global &&\n                typeof event.data === \"string\" &&\n                event.data.indexOf(messagePrefix) === 0) {\n                runIfPresent(+event.data.slice(messagePrefix.length));\n            }\n        };\n\n        if (global.addEventListener) {\n            global.addEventListener(\"message\", onGlobalMessage, false);\n        } else {\n            global.attachEvent(\"onmessage\", onGlobalMessage);\n        }\n\n        registerImmediate = function(handle) {\n            global.postMessage(messagePrefix + handle, \"*\");\n        };\n    }\n\n    function installMessageChannelImplementation() {\n        var channel = new MessageChannel();\n        channel.port1.onmessage = function(event) {\n            var handle = event.data;\n            runIfPresent(handle);\n        };\n\n        registerImmediate = function(handle) {\n            channel.port2.postMessage(handle);\n        };\n    }\n\n    function installReadyStateChangeImplementation() {\n        var html = doc.documentElement;\n        registerImmediate = function(handle) {\n            // Create a <script> element; its readystatechange event will be fired asynchronously once it is inserted\n            // into the document. Do so, thus queuing up the task. Remember to clean up once it's been called.\n            var script = doc.createElement(\"script\");\n            script.onreadystatechange = function () {\n                runIfPresent(handle);\n                script.onreadystatechange = null;\n                html.removeChild(script);\n                script = null;\n            };\n            html.appendChild(script);\n        };\n    }\n\n    function installSetTimeoutImplementation() {\n        registerImmediate = function(handle) {\n            setTimeout(runIfPresent, 0, handle);\n        };\n    }\n\n    // If supported, we should attach to the prototype of global, since that is where setTimeout et al. live.\n    var attachTo = Object.getPrototypeOf && Object.getPrototypeOf(global);\n    attachTo = attachTo && attachTo.setTimeout ? attachTo : global;\n\n    // Don't get fooled by e.g. browserify environments.\n    if ({}.toString.call(global.process) === \"[object process]\") {\n        // For Node.js before 0.9\n        installNextTickImplementation();\n\n    } else if (canUsePostMessage()) {\n        // For non-IE10 modern browsers\n        installPostMessageImplementation();\n\n    } else if (global.MessageChannel) {\n        // For web workers, where supported\n        installMessageChannelImplementation();\n\n    } else if (doc && \"onreadystatechange\" in doc.createElement(\"script\")) {\n        // For IE 6–8\n        installReadyStateChangeImplementation();\n\n    } else {\n        // For older browsers\n        installSetTimeoutImplementation();\n    }\n\n    attachTo.setImmediate = setImmediate;\n    attachTo.clearImmediate = clearImmediate;\n}(typeof self === \"undefined\" ? typeof global === \"undefined\" ? this : global : self));\n","'use strict';\n\nmodule.exports = {\n  processRequest: function(req) {\n    var\n      contentType = req.header('Content-Type'),\n      hasJsonContentType = contentType &&\n                           contentType.indexOf('application/json') !== -1;\n\n    if (contentType != null && !hasJsonContentType) {\n      return;\n    }\n\n    if (req.body) {\n      if (!contentType) {\n        req.header('Content-Type', 'application/json');\n      }\n\n      req.body = JSON.stringify(req.body);\n    }\n  }\n};\n","'use strict';\n\nmodule.exports = {\n  processRequest: function(req) {\n    var accept = req.header('Accept');\n    if (accept == null) {\n      req.header('Accept', 'application/json');\n    }\n  },\n  processResponse: function(res) {\n    // Check to see if the contentype is \"something/json\" or\n    // \"something/somethingelse+json\"\n    if (res.contentType && /^.*\\/(?:.*\\+)?json(;|$)/i.test(res.contentType)) {\n      var raw = typeof res.body === 'string' ? res.body : res.text;\n      if (raw) {\n        res.body = JSON.parse(raw);\n      }\n    }\n  }\n};\n","'use strict';\n\nvar jsonrequest = require('./jsonrequest'),\n    jsonresponse = require('./jsonresponse');\n\nmodule.exports = {\n  processRequest: function(req) {\n    jsonrequest.processRequest.call(this, req);\n    jsonresponse.processRequest.call(this, req);\n  },\n  processResponse: function(res) {\n    jsonresponse.processResponse.call(this, res);\n  }\n};\n","'use strict';\n\nmodule.exports = {\n  processRequest: function(req) {\n    req.url = req.url.replace(/[^%]+/g, function(s) {\n      return encodeURI(s);\n    });\n  }\n};\n","module.exports = window.XMLHttpRequest;\n","'use strict';\n\n// Wrap a function in a `setTimeout` call. This is used to guarantee async\n// behavior, which can avoid unexpected errors.\n\nmodule.exports = function(fn) {\n  return function() {\n    var\n      args = Array.prototype.slice.call(arguments, 0),\n      newFunc = function() {\n        return fn.apply(null, args);\n      };\n    setTimeout(newFunc, 0);\n  };\n};\n","'use strict';\n\nfunction Request(optsOrUrl) {\n  var opts = typeof optsOrUrl === 'string' ? {url: optsOrUrl} : optsOrUrl || {};\n  this.method = opts.method ? opts.method.toUpperCase() : 'GET';\n  this.url = opts.url;\n  this.headers = opts.headers || {};\n  this.body = opts.body;\n  this.timeout = opts.timeout || 0;\n  this.errorOn404 = opts.errorOn404 != null ? opts.errorOn404 : true;\n  this.onload = opts.onload;\n  this.onerror = opts.onerror;\n}\n\nRequest.prototype.abort = function() {\n  if (this.aborted) return;\n  this.aborted = true;\n  this.xhr.abort();\n  return this;\n};\n\nRequest.prototype.header = function(name, value) {\n  var k;\n  for (k in this.headers) {\n    if (this.headers.hasOwnProperty(k)) {\n      if (name.toLowerCase() === k.toLowerCase()) {\n        if (arguments.length === 1) {\n          return this.headers[k];\n        }\n\n        delete this.headers[k];\n        break;\n      }\n    }\n  }\n  if (value != null) {\n    this.headers[name] = value;\n    return value;\n  }\n};\n\n\nmodule.exports = Request;\n","module.exports = extend\n\nfunction extend() {\n    var target = {}\n\n    for (var i = 0; i < arguments.length; i++) {\n        var source = arguments[i]\n\n        for (var key in source) {\n            if (source.hasOwnProperty(key)) {\n                target[key] = source[key]\n            }\n        }\n    }\n\n    return target\n}\n","'use strict';\n\nvar extend = require('xtend');\n\nmodule.exports = function(req) {\n  var xhr = req.xhr;\n  var props = {request: req, xhr: xhr};\n\n  // Try to create the response from the request. If the request was aborted,\n  // accesssing properties of the XHR may throw an error, so we wrap in a\n  // try/catch.\n  try {\n    var lines, i, m, headers = {};\n    if (xhr.getAllResponseHeaders) {\n      lines = xhr.getAllResponseHeaders().split('\\n');\n      for (i = 0; i < lines.length; i++) {\n        if ((m = lines[i].match(/\\s*([^\\s]+):\\s+([^\\s]+)/))) {\n          headers[m[1]] = m[2];\n        }\n      }\n    }\n\n    props = extend(props, {\n      status: xhr.status,\n      contentType: xhr.contentType || (xhr.getResponseHeader && xhr.getResponseHeader('Content-Type')),\n      headers: headers,\n      text: xhr.responseText,\n      body: xhr.response || xhr.responseText\n    });\n  } catch (err) {}\n\n  return props;\n};\n","'use strict';\n\nvar Request = require('./request');\nvar extractResponseProps = require('./utils/extractResponseProps');\n\nfunction Response(props) {\n  this.request = props.request;\n  this.xhr = props.xhr;\n  this.headers = props.headers || {};\n  this.status = props.status || 0;\n  this.text = props.text;\n  this.body = props.body;\n  this.contentType = props.contentType;\n  this.isHttpError = props.status >= 400;\n}\n\nResponse.prototype.header = Request.prototype.header;\n\nResponse.fromRequest = function(req) {\n  return new Response(extractResponseProps(req));\n};\n\n\nmodule.exports = Response;\n","'use strict';\n\nvar Response = require('./response');\nvar extractResponseProps = require('./utils/extractResponseProps');\nvar extend = require('xtend');\n\nfunction RequestError(message, props) {\n  var err = new Error(message);\n  err.name = 'RequestError';\n  this.name = err.name;\n  this.message = err.message;\n  if (err.stack) {\n    this.stack = err.stack;\n  }\n\n  this.toString = function() {\n    return this.message;\n  };\n\n  for (var k in props) {\n    if (props.hasOwnProperty(k)) {\n      this[k] = props[k];\n    }\n  }\n}\n\nRequestError.prototype = extend(Error.prototype);\nRequestError.prototype.constructor = RequestError;\n\nRequestError.create = function(message, req, props) {\n  var err = new RequestError(message, props);\n  Response.call(err, extractResponseProps(req));\n  return err;\n};\n\nmodule.exports = RequestError;\n","'use strict';\n\n// A \"once\" utility.\nmodule.exports = function(fn) {\n  var result, called = false;\n  return function() {\n    if (!called) {\n      called = true;\n      result = fn.apply(this, arguments);\n    }\n    return result;\n  };\n};\n","'use strict';\n\nvar\n  cleanURL = require('../plugins/cleanurl'),\n  XHR = require('./xhr'),\n  delay = require('./utils/delay'),\n  RequestError = require('./error'),\n  Response = require('./response'),\n  Request = require('./request'),\n  extend = require('xtend'),\n  once = require('./utils/once');\n\nvar i,\n    createError = RequestError.create;\n\nfunction factory(defaults, plugins) {\n  defaults = defaults || {};\n  plugins = plugins || [];\n\n  function http(req, cb) {\n    var xhr, plugin, done, k, timeoutId, supportsLoadAndErrorEvents;\n\n    req = new Request(extend(defaults, req));\n\n    for (i = 0; i < plugins.length; i++) {\n      plugin = plugins[i];\n      if (plugin.processRequest) {\n        plugin.processRequest(req);\n      }\n    }\n\n    // Give the plugins a chance to create the XHR object\n    for (i = 0; i < plugins.length; i++) {\n      plugin = plugins[i];\n      if (plugin.createXHR) {\n        xhr = plugin.createXHR(req);\n        break; // First come, first serve\n      }\n    }\n    xhr = xhr || new XHR();\n\n    req.xhr = xhr;\n\n    // Use a single completion callback. This can be called with or without\n    // an error. If no error is passed, the request will be examined to see\n    // if it was successful.\n    done = once(delay(function(rawError) {\n      clearTimeout(timeoutId);\n      xhr.onload = xhr.onerror = xhr.onabort = xhr.onreadystatechange = xhr.ontimeout = xhr.onprogress = null;\n\n      var err = getError(req, rawError);\n\n      var res = err || Response.fromRequest(req);\n      for (i = 0; i < plugins.length; i++) {\n        plugin = plugins[i];\n        if (plugin.processResponse) {\n          plugin.processResponse(res);\n        }\n      }\n\n      // Invoke callbacks\n      if (err && req.onerror) req.onerror(err);\n      if (!err && req.onload) req.onload(res);\n      if (cb) cb(err, err ? undefined : res);\n\n    }));\n\n    supportsLoadAndErrorEvents = ('onload' in xhr) && ('onerror' in xhr);\n    xhr.onload = function() { done(); };\n    xhr.onerror = done;\n    xhr.onabort = function() { done(); };\n\n    // We'd rather use `onload`, `onerror`, and `onabort` since they're the\n    // only way to reliably detect successes and failures but, if they\n    // aren't available, we fall back to using `onreadystatechange`.\n    xhr.onreadystatechange = function() {\n      if (xhr.readyState !== 4) return;\n\n      if (req.aborted) return done();\n\n      if (!supportsLoadAndErrorEvents) {\n        // Assume a status of 0 is an error. This could be a false\n        // positive, but there's no way to tell when using\n        // `onreadystatechange` ):\n        // See matthewwithanm/react-inlinesvg#10.\n\n        // Some browsers don't like you reading XHR properties when the\n        // XHR has been aborted. In case we've gotten here as a result\n        // of that (either our calling `about()` in the timeout handler\n        // or the user calling it directly even though they shouldn't),\n        // be careful about accessing it.\n        var status;\n        try {\n          status = xhr.status;\n        } catch (err) {}\n        var err = status === 0 ? new Error('Internal XHR Error') : null;\n        return done(err);\n      }\n    };\n\n    // IE sometimes fails if you don't specify every handler.\n    // See http://social.msdn.microsoft.com/Forums/ie/en-US/30ef3add-767c-4436-b8a9-f1ca19b4812e/ie9-rtm-xdomainrequest-issued-requests-may-abort-if-all-event-handlers-not-specified?forum=iewebdevelopment\n    xhr.ontimeout = function() { /* noop */ };\n    xhr.onprogress = function() { /* noop */ };\n\n    xhr.open(req.method, req.url);\n\n    if (req.timeout) {\n      // If we use the normal XHR timeout mechanism (`xhr.timeout` and\n      // `xhr.ontimeout`), `onreadystatechange` will be triggered before\n      // `ontimeout`. There's no way to recognize that it was triggered by\n      // a timeout, and we'd be unable to dispatch the right error.\n      timeoutId = setTimeout(function() {\n        req.timedOut = true;\n        done();\n        try {\n          xhr.abort();\n        } catch (err) {}\n      }, req.timeout);\n    }\n\n    for (k in req.headers) {\n      if (req.headers.hasOwnProperty(k)) {\n        xhr.setRequestHeader(k, req.headers[k]);\n      }\n    }\n\n    xhr.send(req.body);\n\n    return req;\n  }\n\n  var method,\n    methods = ['get', 'post', 'put', 'head', 'patch', 'delete'],\n    verb = function(method) {\n      return function(req, cb) {\n        req = new Request(req);\n        req.method = method;\n        return http(req, cb);\n      };\n    };\n  for (i = 0; i < methods.length; i++) {\n    method = methods[i];\n    http[method] = verb(method);\n  }\n\n  http.plugins = function() {\n    return plugins;\n  };\n\n  http.defaults = function(newValues) {\n    if (newValues) {\n      return factory(extend(defaults, newValues), plugins);\n    }\n    return defaults;\n  };\n\n  http.use = function() {\n    var newPlugins = Array.prototype.slice.call(arguments, 0);\n    return factory(defaults, plugins.concat(newPlugins));\n  };\n\n  http.bare = function() {\n    return factory();\n  };\n\n  http.Request = Request;\n  http.Response = Response;\n  http.RequestError = RequestError;\n\n  return http;\n}\n\nmodule.exports = factory({}, [cleanURL]);\n\n/**\n * Analyze the request to see if it represents an error. If so, return it! An\n * original error object can be passed as a hint.\n */\nfunction getError(req, err) {\n  if (req.aborted) return createError('Request aborted', req, {name: 'Abort'});\n\n  if (req.timedOut) return createError('Request timeout', req, {name: 'Timeout'});\n\n  var xhr = req.xhr;\n  var type = Math.floor(xhr.status / 100);\n\n  var kind;\n  switch (type) {\n    case 0:\n    case 2:\n      // These don't represent errors unless the function was passed an\n      // error object explicitly.\n      if (!err) return;\n      return createError(err.message, req);\n    case 4:\n      // Sometimes 4XX statuses aren't errors.\n      if (xhr.status === 404 && !req.errorOn404) return;\n      kind = 'Client';\n      break;\n    case 5:\n      kind = 'Server';\n      break;\n    default:\n      kind = 'HTTP';\n  }\n  var msg = kind + ' Error: ' +\n        'The server returned a status of ' + xhr.status +\n        ' for the request \"' +\n        req.method.toUpperCase() + ' ' + req.url + '\"';\n  return createError(msg, req);\n}\n","/*\n  Copyright 2017 Stratumn SAS. All rights reserved.\n\n  Licensed under the Apache License, Version 2.0 (the \"License\");\n  you may not use this file except in compliance with the License.\n  You may obtain a copy of the License at\n\n      http://www.apache.org/licenses/LICENSE-2.0\n\n  Unless required by applicable law or agreed to in writing, software\n  distributed under the License is distributed on an \"AS IS\" BASIS,\n  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n  See the License for the specific language governing permissions and\n  limitations under the License.\n*/\n\n// Deprecated.\nexport default {\n  applicationUrl: 'https://%s.stratumn.rocks'\n};\n"],"names":["deprecated","oldFunc","newFunc","warn","makeQueryString","obj","parts","Object","keys","reduce","curr","key","val","Array","isArray","join","push","encodeURIComponent","length","promiseWhile","condition","body","Promise","resolve","reject","loop","then","catch","send","method","url","args","err","res","error","meta","errorMessage","Error","status","get","post","findSegments","process","opts","options","assign","limit","batchSize","DEFAULT_BATCH_SIZE","offset","lastBatch","result","newSegments","prefixUrl","map","segmentify","getBranches","agent","prevLinkHash","tags","processInfo","actions","filter","indexOf","forEach","linkHash","getPrev","link","getSegment","load","JSON","parse","stringify","createMap","getMapIds","getLink","hash","getMap","mapId","mapIds","processify","agentUrl","updatedProcess","name","bind","getProcesses","getAgent","processes","p","updatedMap","fromSegment","applicationLocation","segment","getApplication","config","applicationUrl","replace","loadLink","global","undefined","setImmediate","callback","Function","arguments","i","task","tasksByHandle","nextHandle","registerImmediate","clearImmediate","handle","run","apply","runIfPresent","currentlyRunningATask","setTimeout","doc","document","attachTo","getPrototypeOf","toString","call","nextTick","postMessage","importScripts","postMessageIsAsynchronous","oldOnMessage","onmessage","messagePrefix","Math","random","onGlobalMessage","event","source","data","slice","addEventListener","attachEvent","MessageChannel","channel","port1","port2","createElement","html","documentElement","script","onreadystatechange","removeChild","appendChild","self","this","module","exports","processRequest","req","contentType","header","hasJsonContentType","processResponse","test","raw","text","jsonrequest","commonjsHelpers.interopDefault","jsonresponse","s","encodeURI","window","XMLHttpRequest","fn","prototype","Request","optsOrUrl","toUpperCase","headers","timeout","errorOn404","onload","onerror","abort","aborted","xhr","value","k","hasOwnProperty","toLowerCase","extend","target","props","request","lines","m","getAllResponseHeaders","split","match","getResponseHeader","responseText","response","Response","isHttpError","extractResponseProps","fromRequest","RequestError","message","stack","constructor","create","called","factory","defaults","plugins","http","cb","plugin","done","timeoutId","supportsLoadAndErrorEvents","createXHR","XHR","once","delay","rawError","clearTimeout","onabort","ontimeout","onprogress","getError","readyState","open","timedOut","setRequestHeader","methods","newValues","use","newPlugins","concat","bare","createError","kind","type","floor","cleanURL","httpplease","json"],"mappings":"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"}